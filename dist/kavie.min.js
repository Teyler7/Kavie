/*!
    Kavie - knockout observable validator
    Author: Matthew Nitschke
    License: MIT (http://www.opensource.org/licenses/mit-license.php)
    Version: 1.2.0
*/
function KavieSection(){var e=this;e.observables=[],e.children={},e.validate=!0}!function(e){e.sections={},e.reset=function(){e.sections={}},e.isValid=function(e){for(var r=!0,a=t(e),n=0;n<a.length;n++)a[n].startValidation(),r&&a[n].hasError()&&(r=!1);return r},e.isValidAsync=function(r){for(var a=t(r),n=[],i=0;i<a.length;i++){var o=a[i].startAsyncValidation();o&&(n=n.concat(o))}return e.promiseAllBool(n)},e.isSectionValid=function(r){var t=e.sections[r],a=!0;if(ko.unwrap(t.validate)){for(var n=Object.keys(t.children),i=0;i<n.length;i++){var o=e.isSectionValid(n[i]);o||(a=!1)}var s=e.isValid(t.observables);s||(a=!1)}else e.deactivateSection(r);return a},e.isSectionValidAsync=function(r){var t=e.sections[r],a=[];if(ko.unwrap(t.validate)){for(var n=Object.keys(t.children),i=0;i<n.length;i++){var o=e.isSectionValid(n[i]);o||(isValid=!1)}var s=e.isValidAsync(t.observables);s&&a.push(s)}else e.deactivateSection(r);return promiseAllBool(a)},e.deactivate=function(e){for(var r=t(e),a=0;a<r.length;a++)r[a].stopValidation()},e.deactivateSection=function(r){for(var t=e.sections[r],a=Object.keys(t.children),n=0;n<a.length;n++)e.deactivateSection(a[n]);e.deactivate(t.observables)},e.addVariableValidation=function(r,t){var a=e.sections[r];a||(a=e.sections[r]=new KavieSection),a.validate=t},e.addSectionChild=function(r,t){var a=e.sections[r];a||(a=e.sections[r]=new KavieSection),a.children[t]=new KavieSection};var r=function(e){return ko.isObservable(e)&&e.hasOwnProperty("hasError")},t=function(a){if(!a)throw"Data must not be null";var n=[];if(Array.isArray(a))for(var i=0;i<a.length;i++)n=n.concat(t(a[i]));else if("string"==typeof a){var o=e.sections[a];if(!o)throw"No section found with this name: "+a;if(ko.unwrap(o.validate)){for(var s=Object.keys(o.children),i=0;i<s.length;i++)n=n.concat(t(o.children[s[i]]));n=n.concat(o.observables)}}else for(var l=Object.keys(a),i=0;i<l.length;i++)r(a[l[i]])&&n.push(a[l[i]]);return n};e.validatorFunctions={required:{validator:function(e,r){return!e||a(r)},message:"This field is required"},numeric:{validator:function(e,r){return!e||!a(r)||!isNaN(parseFloat(r))&&isFinite(r)},message:"Please enter a numeric value"},maxLength:{validator:function(e,r){return!r||r.length<=parseInt(e)},message:"Please enter a value less than or equal to {propVal}"},minLength:{validator:function(e,r){return!!r&&r.length>=parseInt(e)},message:"Please enter a value greater than or equal to {propVal}"},matches:function(e,r){return ko.unwrap(e)==ko.unwrap(r)},date:{validator:function(e,r){if(e&&a(r)){date=r;var t=/(\d{2})\/(\d{2})\/((\d{4})|(\d{2}))/;if(date.search(t)==-1)return!1;var n=date.split("/"),i=n[0];if(parseInt(i)>12||parseInt(i)<1)return!1;var o=n[2],s=n[1],l=new Date(o,i,0).getDate();return!(parseInt(s)>l||parseInt(s)<1)}return!0},message:"Please enter a valid date"},birthdate:{validator:function(e,r){if(e&&a(r)){if(!Kavie.validatorFunctions.date.validator(e,r))return!1;var t=new Date(r);if(t>new Date)return!1;var n=new Date;return n.setFullYear(n.getFullYear()-120),!(t<n)}return!0},message:"Please enter a valid birthdate"},phone:{validator:function(e,r){return!e||!a(r)||!!r.match(/^(1-?)?(\([2-9]\d{2}\)|[2-9]\d{2})-?[2-9]\d{2}-?\d{4}$/)},message:"Please enter a valid phone number"},email:{validator:function(e,r){return!e||!a(r)||!!r.match(/^(?:(?:[\w`~!#$%^&*\-=+;:{}'|,?\/]+(?:(?:\.(?:"(?:\\?[\w`~!#$%^&*\-=+;:{}'|,?\/\.()<>\[\] @]|\\"|\\\\)*"|[\w`~!#$%^&*\-=+;:{}'|,?\/]+))*\.[\w`~!#$%^&*\-=+;:{}'|,?\/]+)?)|(?:"(?:\\?[\w`~!#$%^&*\-=+;:{}'|,?\/\.()<>\[\] @]|\\"|\\\\)+"))@(?:[a-zA-Z\d\-]+(?:\.[a-zA-Z\d\-]+)*|\[\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\])$/)},message:"Please enter a valid email address"},regexPattern:function(e,r){return null!==r.toString().match(e)}};var a=function(e){return!(null==e||0===e.length)};e.promiseAllBool=function(e){var r=Array.prototype.slice.call(e);return new Promise(function(e,t){function a(i,o){try{if(o&&("object"==typeof o||"function"==typeof o)){var s=o.then;if("function"==typeof s)return void s.call(o,function(e){a(i,e)},t)}if(r[i]=o,0===--n){var l=r.indexOf(!1);e(l>-1?!1:!0)}}catch(c){t(c)}}if(0===r.length)return e([]);for(var n=r.length,i=0;i<r.length;i++)a(i,r[i])})}}(this.Kavie=this.Kavie||{}),ko.extenders.kavie=function(e,r){function t(r){var t=e.rules,a=!0,i=null;for(key in t){var o=Kavie.validatorFunctions[key];if(o&&!o.async){var s=ko.unwrap(t[key]),l=o.validator(s,r);a&&!l&&(a=!1,o.property=s,i=o)}}n(a,i)}function a(r){var t=e.rules,a=[];for(key in t){var i=Kavie.validatorFunctions[key];if(i&&i.async){var o=new Promise(function(e){var a=ko.unwrap(t[key]);i.property=a,i.validator(a,r,function(r){return e({isValid:r,validatorObject:i})})});a.push(o)}}return Promise.all(a).then(function(e){for(var r=0;r<e.length;r++)if(!e[r].isValid)return n(e[r].isValid,e[r].validatorObject),!1;return n(!0,e.validatorObject),!0})}function n(r,t){if(r)e.errorMessage(""),e.hasError(!1);else{if(t.message){var a=t.message,n=t.property;e.errorMessage(a.replace("{propVal}",n))}else e.errorMessage("");e.hasError(!0)}}return e.hasError=ko.observable(),e.errorMessage=ko.observable(),r.section&&(Kavie.sections[r.section]||(Kavie.sections[r.section]=new KavieSection),Kavie.sections[r.section].observables.push(e),r.section=""),e.rules=r,e.startValidation=function(){e.subscription=e.subscribe(t),t(e())},e.startAsyncValidation=function(){return e.subscription=e.subscribe(a),a(e())},e.stopValidation=function(){e.subscription&&e.subscription.dispose(),e.hasError(!1),e.errorMessage("")},e};
!function(e){function n(){}function t(e,n){return function(){e.apply(n,arguments)}}function o(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],s(e,this)}function i(e,n){for(;3===e._state;)e=e._value;return 0===e._state?void e._deferreds.push(n):(e._handled=!0,void o._immediateFn(function(){var t=1===e._state?n.onFulfilled:n.onRejected;if(null===t)return void(1===e._state?r:u)(n.promise,e._value);var o;try{o=t(e._value)}catch(i){return void u(n.promise,i)}r(n.promise,o)}))}function r(e,n){try{if(n===e)throw new TypeError("A promise cannot be resolved with itself.");if(n&&("object"==typeof n||"function"==typeof n)){var i=n.then;if(n instanceof o)return e._state=3,e._value=n,void f(e);if("function"==typeof i)return void s(t(i,n),e)}e._state=1,e._value=n,f(e)}catch(r){u(e,r)}}function u(e,n){e._state=2,e._value=n,f(e)}function f(e){2===e._state&&0===e._deferreds.length&&o._immediateFn(function(){e._handled||o._unhandledRejectionFn(e._value)});for(var n=0,t=e._deferreds.length;n<t;n++)i(e,e._deferreds[n]);e._deferreds=null}function c(e,n,t){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof n?n:null,this.promise=t}function s(e,n){var t=!1;try{e(function(e){t||(t=!0,r(n,e))},function(e){t||(t=!0,u(n,e))})}catch(o){if(t)return;t=!0,u(n,o)}}var a=setTimeout;o.prototype["catch"]=function(e){return this.then(null,e)},o.prototype.then=function(e,t){var o=new this.constructor(n);return i(this,new c(e,t,o)),o},o.all=function(e){var n=Array.prototype.slice.call(e);return new o(function(e,t){function o(r,u){try{if(u&&("object"==typeof u||"function"==typeof u)){var f=u.then;if("function"==typeof f)return void f.call(u,function(e){o(r,e)},t)}n[r]=u,0===--i&&e(n)}catch(c){t(c)}}if(0===n.length)return e([]);for(var i=n.length,r=0;r<n.length;r++)o(r,n[r])})},o.resolve=function(e){return e&&"object"==typeof e&&e.constructor===o?e:new o(function(n){n(e)})},o.reject=function(e){return new o(function(n,t){t(e)})},o.race=function(e){return new o(function(n,t){for(var o=0,i=e.length;o<i;o++)e[o].then(n,t)})},o._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){a(e,0)},o._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},o._setImmediateFn=function(e){o._immediateFn=e},o._setUnhandledRejectionFn=function(e){o._unhandledRejectionFn=e},"undefined"!=typeof module&&module.exports?module.exports=o:e.Promise||(e.Promise=o)}(this);