/*!
    Kavie - knockout observable validator
    Author: Matthew Nitschke
    License: MIT (http://www.opensource.org/licenses/mit-license.php)
    Version: 2.4.1
*/
function KavieSection(){var e=this;e.observables=[],e.rules=[],e.children={},e.validate=!0}!function(e){e.settings={subscriptionValidation:!0},e.sections={},e.reset=function(){e.sections={}},e.isValid=function(e){for(var a=!0,t=r(e),n=0;n<t.length;n++)t[n].startValidation(),a&&t[n].hasError()&&(a=!1);return a},e.isValidAsync=function(a){for(var t=r(a),n=[],s=0;s<t.length;s++){var o=t[s].startAsyncValidation();o&&(n=n.concat(o))}var l=e.isValid(a);return Promise.all(n).then(function(e){return e.every(i)&&l})},e.deactivate=function(e){for(var a=r(e),t=0;t<a.length;t++)a[t].stopValidation()},e.addVariableValidation=function(e,r){var t=a(e);t.validate=r,ko.isObservable(r)&&r.subscribe(function(e){e||ko.utils.arrayMap(t.observables,function(e){e.stopValidation()})})},e.addSectionChild=function(e,r){var t=a(e),n=a(r);t.children[r]=n},e.addSectionValidators=function(e,r){var t=a(e);t.rules=ko.utils.extend(t.rules,r)};var r=function(a){if(!a)throw"Data must not be null";var n=[];if(Array.isArray(a))for(var i=0;i<a.length;i++)n=n.concat(r(a[i]));else if("string"==typeof a){var s=e.sections[a];if(s){if(ko.unwrap(s.validate)){for(var o=Object.keys(s.children),i=0;i<o.length;i++)n=n.concat(r(o[i]));n=n.concat(s.observables),Object.keys(s.rules).length>0&&(n=n.map(function(e){return e.rules=ko.utils.extend(e.rules,s.rules),e}))}}else console.warn("Kavie - No section found with the name: "+a)}else if(t(a))n.push(a);else for(var l=Object.keys(a),i=0;i<l.length;i++)t(a[l[i]])&&n.push(a[l[i]]);return n},a=function(r){var a=e.sections[r];return a||(e.sections[r]=new KavieSection,a=e.sections[r]),a},t=function(e){return ko.isObservable(e)&&e.hasOwnProperty("hasError")},n=function(e){return!(null==e||0===e.length)},i=function(e){return!!e};e.validatorFunctions={required:{validator:function(e,r){return!e||n(r)},message:"This field is required"},numeric:{validator:function(e,r){return!e||!n(r)||!isNaN(parseFloat(r))&&isFinite(r)},message:"Please enter a numeric value"},maxLength:{validator:function(e,r){return!r||r.length<=parseInt(e)},message:"Please enter a value less than or equal to {propVal}"},minLength:{validator:function(e,r){return!!r&&r.length>=parseInt(e)},message:"Please enter a value greater than or equal to {propVal}"},matches:function(e,r){return ko.unwrap(e)==ko.unwrap(r)},date:{validator:function(e,r){if(e&&n(r)){if(!r.match(/^(\d{2})\/(\d{2})\/((\d{4})|(\d{2}))$/))return!1;date=r;var a=date.split("/"),t=a[0];if(parseInt(t)>12||parseInt(t)<1)return!1;var i=a[2];if(0==i)return!1;var s=a[1],o=new Date(i,t,0).getDate();return!(parseInt(s)>o||parseInt(s)<1)}return!0},message:"Please enter a valid date"},birthdate:{validator:function(e,r){if(e&&n(r)){if(!Kavie.validatorFunctions.date.validator(e,r))return!1;var a=new Date(r);if(a>new Date)return!1;var t=new Date;return t.setFullYear(t.getFullYear()-120),!(a<t)}return!0},message:"Please enter a valid birthdate"},phone:{validator:function(e,r){return!e||!n(r)||!!r.match(/^(1-?)?(\([2-9]\d{2}\)|[2-9]\d{2})-?[2-9]\d{2}-?\d{4}$/)},message:"Please enter a valid phone number"},email:{validator:function(e,r){return!e||!n(r)||!!r.match(/^(?:(?:[\w`~!#$%^&*\-=+;:{}'|,?\/]+(?:(?:\.(?:"(?:\\?[\w`~!#$%^&*\-=+;:{}'|,?\/\.()<>\[\] @]|\\"|\\\\)*"|[\w`~!#$%^&*\-=+;:{}'|,?\/]+))*\.[\w`~!#$%^&*\-=+;:{}'|,?\/]+)?)|(?:"(?:\\?[\w`~!#$%^&*\-=+;:{}'|,?\/\.()<>\[\] @]|\\"|\\\\)+"))@(?:[a-zA-Z\d\-]+(?:\.[a-zA-Z\d\-]+)*|\[\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\])$/)},message:"Please enter a valid email address"},regexPattern:function(e,r){return null!==r.toString().match(e)}},e.isSectionValid=function(r){return console.warn("isSectionValid is depricated and will be removed in the next release. Please use isValid('sectionName') instead"),e.isValid(r)},e.isSectionValidAsync=function(r){return console.warn("isSectionValidAsync is depricated and will be removed in the next release. Please use isValidAsync('sectionName') instead"),e.isValidAsync(r)}}(this.Kavie=this.Kavie||{}),ko.extenders.kavie=function(e,r){function a(r){var a=e.rules,t=!0,i=null;for(key in a){var s=Kavie.validatorFunctions[key];if(s&&!s.async){var o=ko.unwrap(a[key]),l=s.validator(o,r);t&&!l&&(t=!1,s.property=o,i=s)}}n(t,i)}function t(r){var a=e.rules,t=[];for(key in a){var i=Kavie.validatorFunctions[key];if(i&&i.async){var s=new Promise(function(e){var t=ko.unwrap(a[key]);i.property=t;var n=i;i.validator(t,r,function(r){return e({isValid:r,validatorObject:n})})});t.push(s)}}return Promise.all(t).then(function(e){for(var r=0;r<e.length;r++)if(!e[r].isValid)return n(e[r].isValid,e[r].validatorObject),!1;return n(!0,e.validatorObject),!0})}function n(r,a){if(r)e.errorMessage(""),e.hasError(!1);else{if(a.message){var t=a.message,n=a.property;e.errorMessage(t.replace("{propVal}",n))}else e.errorMessage("");e.hasError(!0)}}return e.hasError=ko.observable(),e.errorMessage=ko.observable(),r.section&&(Kavie.sections[r.section]||(Kavie.sections[r.section]=new KavieSection),Kavie.sections[r.section].observables.push(e),r.section=""),e.rules?e.rules=ko.utils.extend(e.rules,r):e.rules=r,e.startValidation=function(){Kavie.settings.subscriptionValidation&&(e.subscription=e.subscribe(a)),a(e())},e.startAsyncValidation=function(){return Kavie.settings.subscriptionValidation&&(e.subscription=e.subscribe(t)),t(e())},e.stopValidation=function(){e.subscription&&e.subscription.dispose(),e.hasError(!1),e.errorMessage("")},e};